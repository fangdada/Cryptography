# DES的差分攻击
## Author: 文火
&nbsp;&nbsp;&nbsp;&nbsp;<font size=2>花了几星期研究了点东西，目前**可以差分攻击2,3轮的DES**，加密文件的功能就不写了，我只是研究差分而已。嗯下次看来有时间还要去学一下gitbook，毕竟要是整篇文章都撂这了可读性太低,虽然也没有人看hhhh,目前文档在代码里，看了就知道了，下次有时间了再把差分攻击的推导的算法依据公式放上来也算圆满了。</font></br>
&nbsp;&nbsp;&nbsp;&nbsp;<font size=2>我写的DES最终支持1,2,3轮的差分攻击，des.py分析1轮,des_final.py分析2,3轮，仅为学习与分享之目的。</font></br>

### des.py

- beta1
> 支持最简单的DES加解密与差分表的生成
- beta2
> 1.支持加密轮函数的次数指定 </br>
> 2.S-box的输入输出的demo生成
- beta3
> 支持差分分析的demo版 </br>
> 修正了S盒的输入 (应为xor之前)
- beta4
> 完善单轮差分分析,显示各个K</br>
- beta5
> 修正了加密结束后的密文二进制流的输出
- **done**

</br>

### des_final.py

- **final**
> 支持2,3轮的差分攻击

</br>

目前进度
=======

```shell

fanda@fanda:~/Desktop/crypt-analy$ python
Python 2.7.12 (default, Dec  4 2017, 14:50:18) 
[GCC 5.4.0 20160609] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> from des import DES
>>> a.initS()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'a' is not defined
>>> a=DES()
>>> a.initS()
>>> a.initDES('hello,hell hell hell and hell','01234567',5)
>>> a.auto_diff_analy()
using auto differential analysis( with know all S-boxes' input and output )...
possible set of K1:
0-6: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
6-12: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
12-18: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
18-24: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
24-30: 15
30-36: 2
36-42: 1 d 29
42-48: 3d 32 7 8 27 d 2d 28 12 15 3e 1d 1e 35

possible set of K2:
0-6: 14
6-12: a
12-18: 32
18-24: 24
24-30: 1d 3e
30-36: 8 2c
36-42: 5
42-48: 38 5 27

possible set of K3:
0-6: 34
6-12: a 1c
12-18: 30
18-24: 26
24-30: 10
30-36: 2a
36-42: 13 24
42-48: e

possible set of K4:
0-6: 38
6-12: 1c a 3c
12-18: 18
18-24: 3a 26
24-30: 1b 3c 27
30-36: 3a b
36-42: 16
42-48: 9 11

possible set of K5:
0-6: 38
6-12: 9 31 15 2d 7
12-18: 18 1
18-24: 8 26
24-30: 2a 2c a
30-36: 25
36-42: 8 11
42-48: 2b


>>> a.initDES('hello,hell hell hell and hell, what about the fucking world?','01234567',5)
>>> a.auto_diff_analy()
using auto differential analysis( with know all S-boxes' input and output )...
possible set of K1:
0-6: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
6-12: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
12-18: 0 1 2 3 4 5 6 7 8 9 a b c d e f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
18-24: 3d 4 5 8 2c c 2d 2e 2f 10 11 9 3a 3b 3c d
24-30: 15
30-36: 2
36-42: d
42-48: 12 15 7

possible set of K2:
0-6: 14
6-12: a
12-18: 32
18-24: 24
24-30: 1d
30-36: 8
36-42: 5
42-48: 5

possible set of K3:
0-6: 34
6-12: a
12-18: 30
18-24: 26
24-30: 10
30-36: 2a
36-42: 13
42-48: e

possible set of K4:
0-6: 38
6-12: a
12-18: 18
18-24: 26
24-30: 1b
30-36: b
36-42: 16
42-48: 9

possible set of K5:
0-6: 38
6-12: 9
12-18: 18
18-24: 26
24-30: a
30-36: 25
36-42: 11
42-48: 2b


>>> a.show(1,1)
encrypt string(hex):
['af1965eb5606f05', 'efd8a71b1e9a96f', '1946000384c61b0c', 'e8a19aa75c10974', '94edd7fca928d8b', '2ff3506f0066a1a', '27bb26a619d2a95', '3ebf45cbd2747f92']
group 0:
1 1 0 1 1 1 0 0 1 1 0 1 0 0 1 0 0 0 1 1 0 1 0 1 1 0 0 0 1 1 1 1 0 1 0 0 1 0 0 1 0 1 0 0 1 1 0 1 1 0 0 0 1 0 1 1 1 0 1 1 1 0 0 1
group 1:
1 0 0 0 0 0 1 1 1 1 1 1 1 0 1 0 1 1 0 1 0 1 0 1 1 0 0 0 1 1 0 1 1 1 1 0 0 1 1 1 1 0 0 0 0 1 0 1 1 0 1 1 1 0 1 1 1 1 1 1 1 1 0 1
group 2:
0 0 1 0 0 0 1 0 0 1 0 0 0 0 0 1 1 0 1 1 0 0 1 0 0 1 0 0 1 0 0 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 1 0 1 1 0 1 0 1 0
group 3:
1 0 0 1 0 0 0 1 0 1 1 1 0 1 0 0 0 1 0 1 1 0 0 0 1 1 0 0 1 0 1 0 0 1 0 0 1 1 1 1 0 0 0 0 1 0 1 1 0 0 0 1 0 1 0 1 0 1 0 0 1 1 0 0
group 4:
0 1 0 0 1 1 1 0 1 1 0 0 1 1 0 1 0 0 0 0 1 1 1 1 0 0 0 1 0 1 1 0 1 1 0 1 1 1 1 1 1 0 1 1 1 0 1 0 1 1 1 1 1 0 1 0 0 0 0 0 0 1 0 0
group 5:
0 1 0 1 0 0 1 0 1 0 0 1 0 1 1 0 0 0 1 0 1 1 1 0 0 0 0 0 0 1 1 0 0 0 0 1 0 0 1 0 0 1 0 1 0 1 1 0 1 1 0 0 0 0 1 0 1 1 1 0 1 0 1 1
group 6:
0 0 0 1 1 0 1 0 1 0 1 0 0 1 1 0 1 0 1 0 0 0 0 0 1 0 1 1 0 0 1 0 1 0 1 0 0 1 0 0 0 1 0 1 1 1 1 0 0 1 1 0 1 0 1 0 0 1 0 0 1 1 1 1
group 7:
0 1 1 1 1 1 0 0 1 1 1 1 0 0 1 1 0 1 1 0 0 1 1 1 0 1 0 0 1 1 1 0 1 0 0 1 1 0 1 0 0 1 1 0 0 0 1 1 0 1 0 0 1 0 1 1 1 1 0 1 1 0 1 1
the key:
K1:	0 1 0 1 0 0 0 0 0 0 1 0 1 1 0 0 1 0 1 0 1 1 0 0 0 1 0 1 0 1 0 0 0 0 1 0 0 0 1 1 0 1 0 0 0 1 1 1
K2:	0 1 0 1 0 0 0 0 1 0 1 0 1 1 0 0 1 0 1 0 0 1 0 0 0 1 1 1 0 1 0 0 1 0 0 0 0 0 0 1 0 1 0 0 0 1 0 1
K3:	1 1 0 1 0 0 0 0 1 0 1 0 1 1 0 0 0 0 1 0 0 1 1 0 0 1 0 0 0 0 1 0 1 0 1 0 0 1 0 0 1 1 0 0 1 1 1 0
K4:	1 1 1 0 0 0 0 0 1 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 1 1 0 1 1 0 0 1 0 1 1 0 1 0 1 1 0 0 0 1 0 0 1
K5:	1 1 1 0 0 0 0 0 1 0 0 1 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 1 0 1 0 0 1 0 1 0 1 0 0 0 1 1 0 1 0 1 1
K6:	1 1 1 0 0 0 0 0 1 0 0 1 0 0 1 0 0 1 1 1 0 0 1 0 0 1 0 0 1 1 1 0 1 1 0 1 1 0 0 1 0 0 1 0 0 0 1 0
K7:	1 0 1 0 0 1 0 0 1 1 0 1 0 0 1 0 0 1 1 1 0 0 1 0 1 0 0 0 0 1 0 0 0 1 0 0 1 1 0 1 0 1 1 1 1 0 0 0
K8:	1 0 1 0 0 1 1 0 0 1 0 1 0 0 1 1 0 1 0 1 0 0 1 0 1 1 0 0 1 0 0 1 1 0 0 1 1 0 1 0 0 1 0 1 0 0 0 0
K9:	0 0 1 0 0 1 1 0 0 1 0 1 0 0 1 1 0 1 0 1 0 0 1 1 1 1 0 0 1 0 0 1 1 0 0 0 0 0 1 0 0 1 1 1 1 0 0 0
K10:	0 0 1 0 1 1 1 1 0 1 0 1 0 0 0 1 0 1 0 1 0 0 0 1 1 0 0 1 0 0 0 1 1 1 0 1 1 1 1 0 0 0 0 0 1 1 0 0
K11:	0 0 0 0 1 1 1 1 0 1 0 0 0 0 0 1 1 1 0 1 1 0 0 1 0 0 0 1 1 0 0 0 0 0 0 1 0 1 1 0 1 0 1 1 0 1 0 0
K12:	0 0 0 1 1 1 1 1 0 1 0 0 0 0 0 1 1 0 0 1 1 0 0 1 1 0 0 1 1 0 0 1 0 1 1 0 1 0 0 0 1 0 1 0 0 1 0 1
K13:	0 0 0 1 1 1 1 1 0 0 0 0 1 0 0 1 1 0 0 0 1 0 0 1 0 0 1 0 0 0 1 0 0 1 1 0 1 0 1 0 1 0 0 1 0 0 0 1
K14:	0 0 0 1 1 0 1 1 0 0 1 0 1 0 0 0 1 0 0 0 1 1 0 1 1 0 1 1 0 0 1 1 0 0 1 0 0 0 0 1 0 0 0 1 0 1 1 1
K15:	0 0 0 1 1 0 0 1 0 0 1 0 1 1 0 0 1 0 0 0 1 1 0 0 1 0 1 0 0 1 1 1 0 0 0 0 0 0 1 1 1 0 0 0 0 0 1 0
K16:	0 1 0 1 0 0 0 1 0 0 1 0 1 1 0 0 1 0 0 0 1 1 0 0 0 0 0 1 0 1 1 1 0 0 1 0 0 0 1 1 1 1 0 0 0 0 1 0


```

&nbsp;&nbsp;&nbsp;&nbsp;<font size=2>可以看到K2，3，4，5都被完美还原了。</font></br>
&nbsp;&nbsp;&nbsp;&nbsp;<font size=2>不过这些都是假的多轮分析，常规的攻击DES应该是得到明密文对然后攻击S盒，而不是得到每轮S盒的输入输出，接下来这是个利用差分攻击3轮DES的实例使用，相关代码更新在des_final.py中，最终版支持2，3轮的明密文已知的差分攻击（不建议用１轮，１轮还是用des.py来分析好），4轮以上没有理论支持，得跟人探讨探讨才行了。顺便1,2,3轮的公式推导以后再放：</font></br>
&nbsp;&nbsp;&nbsp;&nbsp;<font size=2>又写了一个用来改变明文块的L0的工具change_L0.py，封装在des_tools类里面，只要修改change_string_L0函数的第三个参数就可以得到更多R0相等的明文块，这样差分攻击就可以把密钥的可能性缩小到更小，可以看到此次差分攻击成功了。<</font></br>

最终分析
=============

```shell

fanda@fanda:~/Desktop/crypt-analy/des$ python
Python 2.7.12 (default, Dec  4 2017, 14:50:18) 
[GCC 5.4.0 20160609] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> from des_final import DES
>>> a=DES()
>>> a.initS()
>>> from change_L0 import des_tools
>>> hello=des_tools.change_string_L0('hello?')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: unbound method change_string_L0() must be called with des_tools instance as first argument (got str instance instead)
>>> hello=des_tools().change_string_L0('hello?')
>>> a.initDES(hello,'01234567',3)
>>> a.auto_diff_analy()
=============================================
using auto differential analysis...
=============================================

using input(strings): ['68656c6c6f3f2020', '2875686d6f3f2060', '3871696d6f3f6070', '3c70696d6f7f7074', '3d70696d2f6f7475', '3d70692d3f6b7575']
using output(plain text): ['8a587f5d53cba72', '22c5eb3d1f30ba27', '8285721462da43c', '756f776bf9ff690a', '6aefebcdb6dc449b', 'd8d3a0a71488034']

the target key: 34 a 30 26 10 2a 13 e 

0-6: 34
6-12: a
12-18: 30
18-24: 26
24-30: 10
30-36: 2a
36-42: 13
42-48: e

>>> a.show(1)
encrypt string(hex):
['8a587f5d53cba72', '22c5eb3d1f30ba27', '8285721462da43c', '756f776bf9ff690a', '6aefebcdb6dc449b', 'd8d3a0a71488034']
group 0:
1 0 1 0 1 1 1 1 1 1 1 0 1 1 0 0 0 0 0 0 1 1 1 1 0 1 1 1 0 1 1 1 1 0 0 1 0 1 0 1 0 0 0 0 1 1 1 0 1 0 1 1 0 1 0 1 0 1 1 0 1 0 0 0
group 1:
1 0 0 1 0 1 1 1 1 1 0 0 1 1 1 0 1 0 0 1 0 0 1 1 1 0 0 0 1 1 0 1 1 0 1 0 1 0 0 1 0 1 1 0 1 1 1 1 0 0 0 1 0 1 0 0 0 0 0 1 1 1 0 0
group 2:
0 0 0 1 1 0 1 0 1 1 1 0 1 1 0 0 0 0 0 1 0 0 1 1 0 0 1 0 0 0 0 0 0 0 1 0 0 1 0 1 1 0 0 0 0 1 0 0 1 0 1 0 1 1 1 0 0 1 1 1 0 0 1 0
group 3:
1 1 1 1 1 1 0 1 0 0 1 1 0 1 1 1 0 1 1 1 0 1 0 0 1 0 1 1 1 0 1 1 1 1 1 0 0 1 0 0 1 1 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1 0 1 0 0 0 0 0
group 4:
0 0 0 1 0 1 1 1 1 1 0 1 0 1 1 0 1 0 1 1 1 0 0 1 0 1 1 1 0 1 1 1 1 0 1 0 0 0 1 0 1 1 0 1 0 1 0 0 0 1 1 1 1 1 0 1 1 0 1 1 0 1 1 1
group 5:
0 0 0 1 1 0 0 1 0 0 0 1 1 0 0 1 1 0 0 0 0 0 1 1 0 1 1 0 0 0 1 0 1 1 0 1 0 0 0 0 0 0 0 0 0 1 0 1 0 1 0 1 0 0 1 0 0 1 1 1 0 1 0 1
the key:
K1:	0 1 0 1 0 0 0 0 0 0 1 0 1 1 0 0 1 0 1 0 1 1 0 0 0 1 0 1 0 1 0 0 0 0 1 0 0 0 1 1 0 1 0 0 0 1 1 1
K2:	0 1 0 1 0 0 0 0 1 0 1 0 1 1 0 0 1 0 1 0 0 1 0 0 0 1 1 1 0 1 0 0 1 0 0 0 0 0 0 1 0 1 0 0 0 1 0 1
K3:	1 1 0 1 0 0 0 0 1 0 1 0 1 1 0 0 0 0 1 0 0 1 1 0 0 1 0 0 0 0 1 0 1 0 1 0 0 1 0 0 1 1 0 0 1 1 1 0
K4:	1 1 1 0 0 0 0 0 1 0 1 0 0 1 1 0 0 0 1 0 0 1 1 0 0 1 1 0 1 1 0 0 1 0 1 1 0 1 0 1 1 0 0 0 1 0 0 1
K5:	1 1 1 0 0 0 0 0 1 0 0 1 0 1 1 0 0 0 1 0 0 1 1 0 0 0 1 0 1 0 1 0 0 1 0 1 0 1 0 0 0 1 1 0 1 0 1 1
K6:	1 1 1 0 0 0 0 0 1 0 0 1 0 0 1 0 0 1 1 1 0 0 1 0 0 1 0 0 1 1 1 0 1 1 0 1 1 0 0 1 0 0 1 0 0 0 1 0
K7:	1 0 1 0 0 1 0 0 1 1 0 1 0 0 1 0 0 1 1 1 0 0 1 0 1 0 0 0 0 1 0 0 0 1 0 0 1 1 0 1 0 1 1 1 1 0 0 0
K8:	1 0 1 0 0 1 1 0 0 1 0 1 0 0 1 1 0 1 0 1 0 0 1 0 1 1 0 0 1 0 0 1 1 0 0 1 1 0 1 0 0 1 0 1 0 0 0 0
K9:	0 0 1 0 0 1 1 0 0 1 0 1 0 0 1 1 0 1 0 1 0 0 1 1 1 1 0 0 1 0 0 1 1 0 0 0 0 0 1 0 0 1 1 1 1 0 0 0
K10:	0 0 1 0 1 1 1 1 0 1 0 1 0 0 0 1 0 1 0 1 0 0 0 1 1 0 0 1 0 0 0 1 1 1 0 1 1 1 1 0 0 0 0 0 1 1 0 0
K11:	0 0 0 0 1 1 1 1 0 1 0 0 0 0 0 1 1 1 0 1 1 0 0 1 0 0 0 1 1 0 0 0 0 0 0 1 0 1 1 0 1 0 1 1 0 1 0 0
K12:	0 0 0 1 1 1 1 1 0 1 0 0 0 0 0 1 1 0 0 1 1 0 0 1 1 0 0 1 1 0 0 1 0 1 1 0 1 0 0 0 1 0 1 0 0 1 0 1
K13:	0 0 0 1 1 1 1 1 0 0 0 0 1 0 0 1 1 0 0 0 1 0 0 1 0 0 1 0 0 0 1 0 0 1 1 0 1 0 1 0 1 0 0 1 0 0 0 1
K14:	0 0 0 1 1 0 1 1 0 0 1 0 1 0 0 0 1 0 0 0 1 1 0 1 1 0 1 1 0 0 1 1 0 0 1 0 0 0 0 1 0 0 0 1 0 1 1 1
K15:	0 0 0 1 1 0 0 1 0 0 1 0 1 1 0 0 1 0 0 0 1 1 0 0 1 0 1 0 0 1 1 1 0 0 0 0 0 0 1 1 1 0 0 0 0 0 1 0
K16:	0 1 0 1 0 0 0 1 0 0 1 0 1 1 0 0 1 0 0 0 1 1 0 0 0 0 0 1 0 1 1 1 0 0 1 0 0 0 1 1 1 1 0 0 0 0 1 0



decrypt string(hex):
['68656c6c6f3f2020', '2875686d6f3f2060', '3871696d6f3f6070', '3c70696d6f7f7074', '3d70696d2f6f7475', '3d70692d3f6b7575']
group 0:
0 1 1 0 1 0 0 0 0 1 1 0 0 1 0 1 0 1 1 0 1 1 0 0 0 1 1 0 1 1 0 0 0 1 1 0 1 1 1 1 0 0 1 1 1 1 1 1 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0
group 1:
0 0 1 0 1 0 0 0 0 1 1 1 0 1 0 1 0 1 1 0 1 0 0 0 0 1 1 0 1 1 0 1 0 1 1 0 1 1 1 1 0 0 1 1 1 1 1 1 0 0 1 0 0 0 0 0 0 1 1 0 0 0 0 0
group 2:
0 0 1 1 1 0 0 0 0 1 1 1 0 0 0 1 0 1 1 0 1 0 0 1 0 1 1 0 1 1 0 1 0 1 1 0 1 1 1 1 0 0 1 1 1 1 1 1 0 1 1 0 0 0 0 0 0 1 1 1 0 0 0 0
group 3:
0 0 1 1 1 1 0 0 0 1 1 1 0 0 0 0 0 1 1 0 1 0 0 1 0 1 1 0 1 1 0 1 0 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 0 1 1 1 0 0 0 0 0 1 1 1 0 1 0 0
group 4:
0 0 1 1 1 1 0 1 0 1 1 1 0 0 0 0 0 1 1 0 1 0 0 1 0 1 1 0 1 1 0 1 0 0 1 0 1 1 1 1 0 1 1 0 1 1 1 1 0 1 1 1 0 1 0 0 0 1 1 1 0 1 0 1
group 5:
0 0 1 1 1 1 0 1 0 1 1 1 0 0 0 0 0 1 1 0 1 0 0 1 0 0 1 0 1 1 0 1 0 0 1 1 1 1 1 1 0 1 1 0 1 0 1 1 0 1 1 1 0 1 0 1 0 1 1 1 0 1 0 1

decrypt string:
hello?  (uhmo? `8qimo?`p<pimopt=pim/otu=pi-?kuu

>>> 


```


&nbsp;&nbsp;&nbsp;&nbsp;<font size=2>嗨呀终于写完了，那么DES就写到这儿了，分组密码再更新一个AES的，等我以后研究完了再上传代码工具8,先告一段落咯。</font></br>
